<!DOCTYPE html><html><head><meta charset="UTF-8" />
  <script src="https://cdn.jsdelivr.net/npm/rdflib@0.20.1/dist/rdflib.min.js">
  </script>
  <script src="./src/index.js"></script>
</head><body><div id="results"></div>
<script>
let store   = $rdf.graph()                 
let fetcher = $rdf.fetcher(store,{fetch:appfetch})

let docRoot     = "app://ls/";
let foldername  = "test-folder/";
let filename    = "test-file.ttl";
let folder      = docRoot + foldername;
let file        = folder + filename;
let DOC         = $rdf.Namespace(file);
const LDP = $rdf.Namespace("http://www.w3.org/ns/ldp#");

async function run(){
    let results;

    localStorage.clear();

    /* CREATE AN IN-BROWSER CONTAINER
    */
    results = await appfetch( docRoot,{
         method : "POST",
         headers: { 
             Slug: foldername,
            "Content-type":"text/turtle",
             Link: '<http://www.w3.org/ns/ldp#BasicContainer>; rel="type"'
        }
    });
    if(results.status===201)
        show(`Created Local Storage Container <${docRoot+foldername}>`);    
    else
        console.log(results);

    /* CREATE AN IN-BROWSER RESOURCE 
    */
    store.add( DOC("#test"), DOC("#message"), "hello world", DOC("") );
    results = await fetcher.putBack( DOC("") );
    if(results.status===201)
        show(`Created Local Storage Resource <${DOC("").uri}>`);    

    /* LOAD AND QUERY AN IN-BROWSER CONTAINER
    */
    clearStore();
    await fetcher.load( folder );
    let files = store.each( $rdf.sym(folder), LDP("contains"));
    if(files.length!=1 && !files[0].value.match(file)) {
        console.log("Bad query of Container");
        console.log(files);
    }
    else
       show(`Loaded & queried Local Storage Container : ${files.length} file`);

    /* LOAD AND QUERY AN IN-BROWSER RESOURCE 
    */
    clearStore();
    await fetcher.load( DOC("") );
    results = store.any( DOC("#test"), DOC("#message"), null );
    if(results)
        show(`Loaded & queried Local Storage Resource : ${results.value}`);

    /* DELETE AN IN-BROWSER RESOURCE & CONTAINER
    */
    await appfetch( DOC("").uri,{Method:"DELETE"} );
    await appfetch( folder,{Method:"DELETE"} );
    clearStore();
    await fetcher.load( docRoot );
    files = store.each( $rdf.sym(folder), LDP("contains"));
    if(files.length!=0) {
        console.log("Expected Container to be empty, it wasn't!");
        console.log(files);
    }
    else
        show(`Deleted Local Storage Resource & Container`);
        show(`Local Storage for this app is now empty`);

    for(let key in localStorage){
        if(key.match(/^app:\/\/\//)) {
            key = key.replace(/^app:\/\//,'');
            show(key);
        }
    }
}
run();
function clearStore(){
    store = $rdf.graph();
    fetcher = $rdf.fetcher(store,{fetch:appfetch});
}
function show(msg){
    let par = document.createElement('p')
    par.appendChild(document.createTextNode(msg));
    document.getElementById("results").appendChild(par);
}
</script></body></html>
